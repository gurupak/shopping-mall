import{a as reactExports,z as SANDBOX_OWNER,C as SANDBOX_REPO,j as jsxRuntimeExports,E as process,F as API_DOMAIN,r as render,H as App,h as useEnvironmentInterface}from"./_VitePage-c1284752.js";import{b as useSafeRouter,c as createQueryApi,d as context,W,e as Provider,h}from"./InitPitcher-e3438ec0.js";import{c as convertSandboxToProject}from"./sandbox-5f0ca87c.js";import{a as EditorPageSandboxContent}from"./index-2ebfe86a.js";import"./index-e77ccd73.js";import{p as pathBrowserify}from"./index-412f48c1.js";import"./index-a17faffc.js";import"./pitcher-ed4b851e.js";import"./router-7afd07fe.js";import"./browserDetection-7165391b.js";import"./index-1e3d54a0.js";import"./SessionMatcher-4934f5b4.js";import"./assistantClientAvatar-66de2688.js";import"./csb-model-10bb7461.js";import"./useOpenInVsCode-c5c6ce5a.js";import"./ClientsList-b1ef56ef.js";import"./usePreviewProtocol-7bc20f47.js";const SandboxRouterProvider=({children:e,sandboxId:s})=>{const r=useSafeRouter(),o=reactExports.useMemo(()=>({urlParams:{owner:SANDBOX_OWNER,repo:SANDBOX_REPO,branch:s},queryParams:{file:createQueryApi(r,"file",{preventEncoding:!0}),create:createQueryApi(r,"create"),import:createQueryApi(r,"import"),layout:createQueryApi(r,"layout"),mode:createQueryApi(r,"mode"),sidebar:createQueryApi(r,"sidebar",{isJson:!0}),workspaceId:createQueryApi(r,"workspaceId"),welcome:createQueryApi(r,"welcome")},goToBranch({branch:n}){return r.transition(t=>{const i={...t.query,id:n};return t.push({pathname:t.pathname,query:i},void 0,{shallow:!0})})},updateCurrentBranch({branch:n}){return r.transition(t=>{const i={...t.query,id:n};return t.replace({pathname:t.pathname,query:i},void 0,{shallow:!0})})}}),[s]);return jsxRuntimeExports.jsx(context.Provider,{value:o,children:e})};let f=null;function initUrqlClient(e,s){const r=typeof window>"u";return(r||!f)&&(f=W({...e,suspense:s&&(r||e.suspense)}),f.toJSON=()=>null),f}if(typeof window>"u"){const fs=eval('require("fs")'),pages=fs.readdirSync(pathBrowserify.join(process.cwd(),"src","vite-pages")).filter(e=>!e.startsWith("_")).map(e=>pathBrowserify.basename(e,".tsx")),buildFiles=fs.readdirSync(pathBrowserify.join(process.cwd(),"public","pages","assets"));pages.forEach(e=>{buildFiles.find(r=>r.startsWith(`${e}-`))}),buildFiles.find(e=>e.startsWith("index-")&&e.endsWith(".css"))}else if(typeof window>"u"){const fs=eval('require("fs")'),pages=fs.readdirSync(pathBrowserify.join(process.cwd(),"src","vite-pages")).filter(e=>!e.startsWith("_")).map(e=>pathBrowserify.basename(e,".tsx"));pages.forEach(e=>{})}function getSandboxIdFromUrlParam(e){return(Array.isArray(e)?e||[]:[e]).join("/")}const API_URL=new URL(`${API_DOMAIN}/api/graphql`),URQLClientProvider=({children:e})=>{const{api:s}=useEnvironmentInterface(),[r,o]=reactExports.useState();return reactExports.useEffect(()=>{r||s.getJwtToken().then(n=>{const t=API_URL.origin===window.location.origin,i=initUrqlClient({url:API_URL.toString(),fetchOptions:{headers:{...t?{"x-codesandbox-client":"web"}:{},authorization:`Bearer ${n}`}}},!1);i&&o(i)})},[s,r]),r?jsxRuntimeExports.jsx(h,{value:r,children:e}):null};render(({data:e})=>{const r=useSafeRouter().query.id,o=getSandboxIdFromUrlParam(r),n=typeof r=="string"?r:r.join("/");if(!e)return jsxRuntimeExports.jsx(App,{children:jsxRuntimeExports.jsx(URQLClientProvider,{children:jsxRuntimeExports.jsx(SandboxRouterProvider,{sandboxId:o,children:jsxRuntimeExports.jsx(Provider,{sandboxId:o,children:jsxRuntimeExports.jsx(EditorPageSandboxContent,{project:null})})})})});const{initialSandboxInfo:t}=e;return jsxRuntimeExports.jsx(App,{children:jsxRuntimeExports.jsx(URQLClientProvider,{children:jsxRuntimeExports.jsx(SandboxRouterProvider,{sandboxId:o,children:jsxRuntimeExports.jsx(Provider,{initialSandboxInfo:t,sandboxId:o,children:jsxRuntimeExports.jsx(EditorPageSandboxContent,{project:convertSandboxToProject(n,t)})})})})})});
